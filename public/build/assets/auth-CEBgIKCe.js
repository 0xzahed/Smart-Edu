document.addEventListener("DOMContentLoaded",()=>{const l=document.getElementById("loginForm");if(l){const u=document.getElementById("emailInput"),m=document.getElementById("passwordInput"),d=document.getElementById("roleInput");document.querySelectorAll(".role-tab").forEach(a=>{a.addEventListener("click",()=>{document.querySelectorAll(".role-tab").forEach(n=>n.classList.remove("active")),a.classList.add("active"),d.value=a.dataset.role})}),l.addEventListener("submit",a=>{let n=!1;const f=u.value.trim();/@diu\.edu\.bd$/i.test(f)?(document.getElementById("emailError")?.classList.add("hidden"),u.classList.remove("ring-2","ring-red-400")):(n=!0,document.getElementById("emailError")?.classList.remove("hidden"),u.classList.add("ring-2","ring-red-400")),m.value?document.getElementById("passwordError")?.classList.add("hidden"):(n=!0,document.getElementById("passwordError")?.classList.remove("hidden")),n&&a.preventDefault()})}});document.addEventListener("DOMContentLoaded",function(){const l=document.getElementById("loginForm")!==null,u=document.getElementById("registrationForm")!==null;if(l){let r=function(){const t=n.value.trim(),i=f.value.trim();return t?t.includes("@diu.edu.bd")?i?i.length<6?(showError("Password must be at least 6 characters long"),!1):!0:(showError("Please enter your password"),!1):(showError("Please use your @diu.edu.bd email address"),!1):(showError("Please enter your email"),!1)};var m=r;const d=document.querySelectorAll(".role-tab"),a=document.getElementById("loginForm"),n=document.getElementById("emailInput"),f=document.getElementById("passwordInput"),g=document.getElementById("loginButton"),c=document.getElementById("roleInput");let o="student";d.forEach(t=>{t.addEventListener("click",function(){d.forEach(i=>{i.classList.remove("active")}),this.classList.add("active"),o=this.getAttribute("data-role"),c.value=o})}),a.addEventListener("submit",function(t){if(t.preventDefault(),!r())return;g.disabled=!0,g.innerHTML='<i class="fas fa-spinner fa-spin mr-2"></i>Signing In...';const i=document.createElement("input");i.type="hidden",i.name="role",i.value=o;const v=this.querySelector('input[name="role"]');v&&v!==document.getElementById("roleInput")&&v.remove();const I=document.getElementById("roleInput");I?I.value=o:this.appendChild(i),this.submit()}),[n,f].forEach(t=>{t.addEventListener("focus",function(){this.parentElement.classList.add("ring-2","ring-white/30")}),t.addEventListener("blur",function(){this.parentElement.classList.remove("ring-2","ring-white/30")})});const E=document.getElementById("googleLogin"),p=document.getElementById("githubLogin");E&&E.addEventListener("click",function(t){t.preventDefault(),window.location.href=`/auth/google?role=${o}`}),p&&p.addEventListener("click",function(t){t.preventDefault(),window.location.href=`/auth/github?role=${o}`}),document.getElementById("forgotPasswordLink")?.addEventListener("click",function(t){t.preventDefault(),showInfo("Forgot password functionality will be implemented soon!")});const y=document.getElementById("registerLink");y&&y.addEventListener("click",function(t){t.preventDefault(),window.location.href="/register"})}if(u){const d=document.getElementById("registrationForm"),a=document.querySelectorAll(".role-card"),n=document.getElementById("selectedRole"),f=document.getElementById("idField"),g=document.getElementById("idLabel"),c=document.getElementById("userId"),o=document.getElementById("student_id"),r=document.getElementById("employee_id"),E=document.getElementById("password"),p=document.getElementById("password_confirmation"),y=document.getElementById("togglePassword"),t=document.getElementById("togglePasswordConfirmation"),i=document.getElementById("submitBtn"),v=document.getElementById("submitText"),I=document.getElementById("submitLoader"),h=document.getElementById("roleError");a.forEach(s=>{s.addEventListener("click",function(){a.forEach(L=>L.classList.remove("selected")),this.classList.add("selected");const e=this.getAttribute("data-role");n.value=e,e&&(f.classList.remove("hidden"),e==="student"?(g.textContent="Student ID",c.placeholder="221-15-4716",c.setAttribute("required","required")):e==="instructor"&&(g.textContent="Employee ID",c.placeholder="EMP001",c.setAttribute("required","required")),h&&h.classList.add("hidden"))})}),y&&E&&y.addEventListener("click",function(){const s=E.getAttribute("type")==="password"?"text":"password";E.setAttribute("type",s);const e=this.querySelector("i");e&&(s==="text"?(e.classList.remove("fa-eye"),e.classList.add("fa-eye-slash")):(e.classList.remove("fa-eye-slash"),e.classList.add("fa-eye")))}),t&&p&&t.addEventListener("click",function(){const s=p.getAttribute("type")==="password"?"text":"password";p.setAttribute("type",s);const e=this.querySelector("i");e&&(s==="text"?(e.classList.remove("fa-eye-slash"),e.classList.add("fa-eye")):(e.classList.remove("fa-eye"),e.classList.add("fa-eye-slash")))}),c&&c.addEventListener("input",function(){const s=n.value,e=this.value;s==="student"?(o&&(o.value=e),r&&(r.value="")):s==="instructor"&&(r&&(r.value=e),o&&(o.value=""))}),d&&d.addEventListener("submit",function(s){if(!n||!n.value)return s.preventDefault(),h&&(h.classList.remove("hidden"),h.scrollIntoView({behavior:"smooth"})),!1;i&&(i.disabled=!0),v&&(v.textContent="Creating Account..."),I&&I.classList.remove("hidden");const e=n.value,L=c?c.value:"";e==="student"?(o&&(o.value=L),r&&(r.value="")):e==="instructor"&&(r&&(r.value=L),o&&(o.value=""))});const w=n?n.value:"";if(w){const s=document.querySelector(`[data-role="${w}"]`);s&&s.click()}}});window.authPageFunctions={showError:function(l){console.error("Auth Error:",l)},showMessage:function(l,u){console.log(`Auth ${u}:`,l)}};window.loginWithGoogle=function(l){document.querySelectorAll('button[onclick*="loginWithGoogle"]').forEach(m=>{m.disabled=!0,m.classList.add("opacity-50","cursor-not-allowed");const d=m.querySelector("span");d&&(d.innerHTML='<i class="fas fa-spinner fa-spin mr-2"></i>Redirecting...')}),window.location.href=`/auth/google/${l}`};
